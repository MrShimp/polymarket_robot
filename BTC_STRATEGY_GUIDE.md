# BTC 15分钟策略使用指南

## 策略概述

这是一个专门针对 Polymarket BTC 15分钟预测市场的自动化交易策略，完全按照你提供的策略逻辑实现。

### 核心特性

- **时段控制**: 10:00 AM – 07:00 PM (北京时间)
- **频次限制**: 每个15分钟区间只下1单
- **智能入场**: 时间窗口 + 价格波动阈值(±30刀) + 动量确认
- **精准出场**: 75%入场、90%止盈、55%止损
- **特殊保护**: 85%+连续30秒涨幅<3刀自动止盈

## 快速开始

### 1. 测试策略

首先运行测试确保一切正常：

```bash
python test_btc_strategy.py
```

### 2. 启动监控面板

在一个终端窗口中启动监控面板：

```bash
python btc_strategy_monitor.py
```

### 3. 运行策略

在另一个终端窗口中启动策略：

```bash
# 命令行模式
python run_btc_strategy.py <market_id> <yes|no> [amount]

# 示例
python run_btc_strategy.py 123456 yes 15

# 或者交互模式
python run_btc_strategy.py
```

## 策略参数详解

### 时间过滤
- **交易时段**: 10:00-19:00 北京时间
- **入场窗口**: 区间开始10分钟后 - 结算前1分钟
- **避开时段**: 美盘深夜、亚盘低波动期

### 价格过滤
- **基准价格**: 每个15分钟区间开始时的BTC价格
- **波动阈值**: ±30刀 (实际使用32-35刀缓冲)
- **动量确认**: 15秒内价格变化密集度检测

### 交易执行
- **入场条件**: 概率≥75% + 价格方向匹配 + 波动阈值
- **止盈条件**: 概率≥90%
- **止损条件**: 概率≤55%
- **特殊止盈**: 概率≥85% + 连续30秒涨幅<3刀

## 数据源优化

策略使用多重优化来处理价格数据不一致问题：

### A. 观测缓冲期
- 使用32-35刀阈值替代30刀
- 抵消1-2刀的数据延迟

### B. 动量确认 (VAP逻辑)
- 检查Binance WebSocket密集买单流
- 确认全网均价同步上扬

### C. 30秒衰减逻辑前置
- 横盘15秒即开始准备平仓
- 避免流动性变差时的不利价格

## 文件结构

```
btc_15min_strategy.py      # 主策略实现
run_btc_strategy.py        # 快速启动脚本
btc_strategy_monitor.py    # 实时监控面板
test_btc_strategy.py       # 策略测试套件
config/btc_strategy_config.json  # 策略配置文件
```

## 数据目录

```
data/
├── btc_strategy_logs/     # 策略运行日志
├── btc_trades/           # 交易记录
├── btc_intervals/        # 15分钟区间数据
└── test_reports/         # 测试报告
```

## 监控和日志

### 实时监控
- 北京时间和交易时段状态
- BTC价格变化和趋势
- 策略参数和持仓状态
- 今日交易统计和最近交易

### 日志记录
- 详细的策略执行日志
- 入场/出场决策记录
- 价格变化和区间数据
- 错误和异常处理

## 风险管理

### 内置保护
- 每个区间最多1笔交易
- 时间窗口严格控制
- 多重出场条件
- 数据源容错处理

### 建议设置
- 单笔交易金额: $10-20
- 每日最大交易次数: 20笔
- 最大单日亏损: $100

## 常见问题

### Q: 策略不入场怎么办？
A: 检查以下条件：
1. 是否在交易时段 (10:00-19:00北京时间)
2. 是否在有效入场窗口 (区间开始10分钟后)
3. BTC价格波动是否达到阈值 (±32刀)
4. 概率是否达到75%
5. 方向是否匹配 (上涨选yes，下跌选no)

### Q: 如何调整策略参数？
A: 修改 `config/btc_strategy_config.json` 文件中的参数，或直接修改策略代码中的参数。

### Q: 如何查看历史交易？
A: 查看 `data/btc_trades/` 目录下的JSON文件，或使用监控面板查看最近交易。

### Q: 策略崩溃了怎么办？
A: 
1. 检查日志文件找出错误原因
2. 运行测试套件验证策略状态
3. 重启策略前确保没有未平仓的持仓

## 高级用法

### 自定义配置
```python
# 修改策略参数
strategy = BTC15MinStrategy()
strategy.entry_probability = 0.80  # 提高入场阈值到80%
strategy.price_threshold = 25      # 降低价格阈值到25刀
```

### 批量运行
```bash
# 同时监控多个市场
python run_btc_strategy.py market1 yes 10 &
python run_btc_strategy.py market2 no 10 &
```

### 数据分析
```python
# 分析交易记录
import json
import glob

trade_files = glob.glob("data/btc_trades/*.json")
for file in trade_files:
    with open(file) as f:
        trade = json.load(f)
        print(f"盈利: {trade['profit']}, 原因: {trade['exit_reason']}")
```

## 注意事项

1. **网络连接**: 确保稳定的网络连接，策略依赖实时价格数据
2. **API限制**: 注意Polymarket API的调用频率限制
3. **资金管理**: 合理设置交易金额，不要超过风险承受能力
4. **市场风险**: 加密货币市场波动剧烈，策略不保证盈利
5. **监管合规**: 确保在你的司法管辖区内合法使用

## 技术支持

如果遇到问题：
1. 查看日志文件获取详细错误信息
2. 运行测试套件检查策略状态
3. 检查网络连接和API配置
4. 查看监控面板了解实时状态

---

**免责声明**: 本策略仅供学习和研究使用，不构成投资建议。使用者需自行承担交易风险。